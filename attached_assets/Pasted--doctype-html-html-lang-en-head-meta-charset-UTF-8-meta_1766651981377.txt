<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Cyber Terminal Simulator</title>

    <style>
      :root{
        --bg:#050805;
        --green:#39ff14;
        --green2:#7cff6a;
        --border:rgba(57,255,20,.28);
        --panel:rgba(0,0,0,.35);
      }
      *{ box-sizing:border-box; }
      body{
        margin:0;
        background:radial-gradient(circle at top, #0a1b12 0, #030704 45%, #000 100%);
        color:var(--green);
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      }

      /* ===== Hack view ===== */
      #hackView{ display:block; }
      .wrap{ max-width:1000px; margin:0 auto; padding:18px 12px 40px; }
      .title{
        font-size:26px; margin:10px 0 10px;
        text-shadow:0 0 16px rgba(57,255,20,.20);
      }
      .subtitle{
        margin:0 0 16px; line-height:1.4;
        color:rgba(57,255,20,.75);
      }
      .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

      button{
        cursor:pointer;
        background:transparent;
        color:var(--green);
        border:1px solid var(--border);
        padding:10px 12px;
        font-family:inherit;
        font-size:14px;
      }
      button:hover{ border-color:rgba(57,255,20,.6); }
      button:disabled{ opacity:.55; cursor:not-allowed; }

      .panel{
        background:rgba(0,0,0,.22);
        border:1px solid var(--border);
        padding:12px;
        margin-top:14px;
      }

      #term{
        height:340px;
        overflow:auto;
        padding:12px;
        border:1px solid var(--border);
        background:var(--panel);
        line-height:1.35;
        white-space:pre-wrap;
      }
      .dim{ color:rgba(57,255,20,.7); }
      .ok{ color:var(--green2); }
      .info{ color:#7df3ff; }
      .warn{ color:#ffb45a; }

      /* ===== Facts view (doc style) ===== */
      #factsView{
        position:fixed;
        inset:0;
        display:none;
        background:#ffffff;
        color:#000000;
        z-index:50;
        overflow:auto;
      }
      #factsView.visible{ display:block; }

      #factsDocWrap{
        width:min(900px, 100%);
        margin:0 auto;
        padding:22px 12px 40px;
      }
      #factsDoc{
        background:#fff;
        border:1px solid #e6e6e6;
        padding:34px 40px;
        font-family:"Times New Roman", Times, serif;
      }
      #factsTop{
        display:flex;
        justify-content:space-between;
        gap:12px;
        flex-wrap:wrap;
        align-items:flex-start;
      }
      #factsTitle{
        margin:0;
        font-size:28px;
        font-weight:700;
      }
      #factsStatus{
        margin-top:6px;
        color:#444;
        font-size:14px;
      }
      #factsBtns button{
        padding:6px 10px;
        background:#f6f6f6;
        border:1px solid #d8d8d8;
        color:#111;
      }
      #factsBtns button:hover{ border-color:#999; }

      #factsError{
        display:none;
        border:1px solid #ffb3b3;
        background:#fff5f5;
        padding:12px;
        margin-top:12px;
        white-space:pre-wrap;
      }
      #factsText{
        margin:0;
        font-size:16px;
        line-height:1.45;
        white-space:pre-wrap;
        word-break:break-word;
      }

      @media print{
        .no-print{ display:none !important; }
        body{ background:#fff !important; }
      }
    </style>
  </head>

  <body>
    <!-- ===================== HACK VIEW ===================== -->
    <div id="hackView">
      <div class="wrap">
        <div class="title">Cyber Terminal Simulator</div>
        <div class="subtitle">
          This is a harmless terminal animation (no real hacking). Press <b>Shift + H</b> to open the
          “History Facts” document (1000 facts).
        </div>

        <div class="row">
          <button id="btnStart">Start</button>
          <button id="btnClear">Clear</button>
          <button id="btnHelp">Help</button>
        </div>

        <div class="panel">
          <div id="term" aria-label="terminal"></div>
          <div class="subtitle" style="margin:10px 0 0; font-size:12px;">
            Tip: Shift+H works anywhere (as long as you’re not typing in an input).
          </div>
        </div>
      </div>
    </div>

    <!-- ===================== FACTS VIEW ===================== -->
    <div id="factsView">
      <div id="factsDocWrap">
        <div id="factsDoc">
          <div id="factsTop" class="no-print">
            <div>
              <h1 id="factsTitle">History Facts</h1>
              <div id="factsStatus">Loading 1000 facts…</div>
            </div>
            <div id="factsBtns">
              <button id="factsBackBtn">Back</button>
              <button id="factsRefreshBtn">Refresh</button>
              <button id="factsPrintBtn">Print</button>
            </div>
          </div>

          <hr class="no-print" style="margin:16px 0; border:none; border-top:1px solid #e6e6e6;" />

          <div id="factsError"></div>
          <pre id="factsText"></pre>
        </div>
      </div>
    </div>

    <script>
      /* =====================
         TERMINAL SIM (SAFE)
         ===================== */
      const term = document.getElementById("term");

      function logLine(text, cls) {
        const div = document.createElement("div");
        if (cls) div.className = cls;
        div.textContent = text;
        term.appendChild(div);
        term.scrollTop = term.scrollHeight;
      }

      function clearTerminal() {
        term.innerHTML = "";
      }

      function startBootTyping() {
        clearTerminal();

        const now = new Date();
        const tz = (Intl.DateTimeFormat().resolvedOptions().timeZone) || "unknown";
        const lines = [
          "[BOOT] Initializing simulation…",
          `[TIME] ${now.toISOString()}`,
          `[ZONE] ${tz}`,
          "[OK] Local demo mode enabled (no real access).",
          "[SCAN] Simulating system checks…",
          "[OK] UI online.",
          "[TIP] Press Shift+H for History Facts (1000)."
        ];

        let i = 0;
        const timer = setInterval(() => {
          const t = lines[i];
          logLine(t, t.startsWith("[OK]") ? "ok" : t.startsWith("[TIP]") ? "info" : "");
          i++;
          if (i >= lines.length) clearInterval(timer);
        }, 230);
      }

      document.getElementById("btnStart").addEventListener("click", startBootTyping);
      document.getElementById("btnClear").addEventListener("click", clearTerminal);
      document.getElementById("btnHelp").addEventListener("click", () => {
        logLine("[HELP] Shift+H opens the History Facts document page.", "dim");
      });

      /* =====================
         VIEW SWITCHING
         ===================== */
      const hackView = document.getElementById("hackView");
      const factsView = document.getElementById("factsView");

      function showHack() {
        factsView.classList.remove("visible");
        hackView.style.display = "block";
      }

      function showFacts() {
        hackView.style.display = "none";
        factsView.classList.add("visible");
        loadFacts({ forceRefresh: false });
      }

      // Shift + H for everyone
      window.addEventListener("keydown", (e) => {
        const tag = (e.target && e.target.tagName || "").toLowerCase();
        const typing = tag === "input" || tag === "textarea" || e.target.isContentEditable;
        if (typing) return;

        const isH = e.key === "H" || e.key === "h" || e.code === "KeyH";
        if (e.shiftKey && isH) {
          e.preventDefault();
          showFacts();
        }
      });

      document.getElementById("factsBackBtn").addEventListener("click", showHack);
      document.getElementById("factsRefreshBtn").addEventListener("click", () => loadFacts({ forceRefresh: true }));
      document.getElementById("factsPrintBtn").addEventListener("click", () => window.print());

      /* =====================
         1000 HISTORY FACTS (WIKIDATA)
         ===================== */
      const factsStatus = document.getElementById("factsStatus");
      const factsError = document.getElementById("factsError");
      const factsText = document.getElementById("factsText");

      const WDQS_ENDPOINT = "https://query.wikidata.org/sparql";
      const FACTS_CACHE_KEY = "historyFacts1000_cache_html_v1";
      const CACHE_MAX_AGE_MS = 7 * 24 * 60 * 60 * 1000;

      function formatWikidataDate(iso) {
        const m = String(iso).match(/^(-?\\d{1,6})-(\\d{2})-(\\d{2})/);
        if (!m) return String(iso);

        const year = Number(m[1]);
        const month = Number(m[2]);
        const day = Number(m[3]);

        const monthNames = [
          "January","February","March","April","May","June",
          "July","August","September","October","November","December"
        ];
        const mm = monthNames[month - 1] || ("Month " + month);

        if (year <= 0) {
          const bce = 1 - year;
          return mm + " " + day + ", " + bce + " BCE";
        }
        return mm + " " + day + ", " + year;
      }

      function toFactLine(row) {
        const dateIso = row?.date?.value || "";
        const label = row?.eventLabel?.value || "Unknown event";
        const desc = row?.eventDescription?.value || "";
        const dateText = dateIso ? formatWikidataDate(dateIso) : "Unknown date";
        return desc
          ? `On ${dateText}, ${label} — ${desc}.`
          : `On ${dateText}, ${label}.`;
      }

      async function fetchFacts1000() {
        const sparql = `
PREFIX wd: <http://www.wikidata.org/entity/>
PREFIX wdt: <http://www.wikidata.org/prop/direct/>
PREFIX wikibase: <http://wikiba.se/ontology#>
PREFIX bd: <http://www.bigdata.com/rdf#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

SELECT ?eventLabel ?eventDescription ?date WHERE {
  {
    SELECT ?event ?date WHERE {
      ?event wdt:P31/wdt:P279* wd:Q1190554 .
      OPTIONAL { ?event wdt:P585 ?date . }
      OPTIONAL { ?event wdt:P580 ?date . }
      FILTER(BOUND(?date) && DATATYPE(?date) = xsd:dateTime)
    }
    ORDER BY DESC(?date)
    LIMIT 1000
  }
  SERVICE wikibase:label { bd:serviceParam wikibase:language "en". }
}
`;
        const url = WDQS_ENDPOINT + "?format=json&query=" + encodeURIComponent(sparql);
        const res = await fetch(url, { headers: { Accept: "application/sparql-results+json" } });
        if (!res.ok) throw new Error("Wikidata request failed: " + res.status + " " + res.statusText);

        const json = await res.json();
        const bindings = json?.results?.bindings || [];
        return bindings.map(toFactLine).filter(Boolean).slice(0, 1000);
      }

      async function loadFacts({ forceRefresh }) {
        factsError.style.display = "none";
        factsError.textContent = "";
        factsText.textContent = "";
        factsStatus.textContent = "Loading 1000 facts…";

        try {
          if (!forceRefresh) {
            const cachedRaw = localStorage.getItem(FACTS_CACHE_KEY);
            if (cachedRaw) {
              const cached = JSON.parse(cachedRaw);
              const okAge = Date.now() - (cached.savedAt || 0) < CACHE_MAX_AGE_MS;
              if (okAge && Array.isArray(cached.facts) && cached.facts.length) {
                factsStatus.textContent = cached.facts.length + " facts (cached)";
                factsText.textContent = cached.facts.map((f, i) => (i + 1) + ". " + f).join("\\n");
                return;
              }
            }
          }

          const facts = await fetchFacts1000(); // exactly up to 1000
          localStorage.setItem(FACTS_CACHE_KEY, JSON.stringify({ savedAt: Date.now(), facts }));

          factsStatus.textContent = facts.length + " facts";
          factsText.textContent = facts.map((f, i) => (i + 1) + ". " + f).join("\\n");
        } catch (err) {
          factsStatus.textContent = "Could not load facts";
          factsError.style.display = "block";
          factsError.textContent =
            "Error: " + (err?.message || String(err)) +
            "\\n\\nThis can happen if Wikidata is blocked on your network or temporarily down. Try Refresh.";
        }
      }

      // auto-start typing on load
      function boot() {
        logLine("[READY] Simulator loaded.", "ok");
        logLine("[TIP] Click Start, or press Shift+H for History Facts.", "info");
      }
      if (document.readyState === "loading") document.addEventListener("DOMContentLoaded", boot);
      else boot();
    </script>
  </body>
</html>